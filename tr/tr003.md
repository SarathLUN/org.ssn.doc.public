```
TR: 003
Title: SSN QR Code Technical Details Based On EMV Co Standard
Author: Tim Bodyka Heng <heng.bodyka@sabay.com>
Status: Active
Created: 2019-09-17
Updated: 2019-09-17
Version 1.0.0
```

SSN QR Code Technical Details Based On EMV Co Standard
===========================================

When a merchant would like to request a payment from a customer, they can create a payment request in a form of a QR code that they can send to the customer. This QR code can be generated from either the SSN Merchant dashboard or the SSN Mobile app. The customer can then scan the QR code and proceed to make a payment as requested by the merchant.

SSN QR Codes are based on EMVCo's EMV&reg; QR Code standard. With EMV QR code standard, users can use existing mobile banking or digital wallet apps that support EMV QR Code to scan the code generated by SSN merchants. 

**Aside from the Public Key from the Payment Address Resolver request, all other information regarding payment (transaction currency, transaction amount etc.) shall be read from the QR Code.**

## QR Code Payload

### Data Description

The content of the QR Code generated from SSN includes the following information:

| Data Object                  | Description                                                                                                                                                                                                                                                                                      |
| ---------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| Payload Format Indictor      | Defines the version of the QR Code template and hence the conventions on the identifiers, lengths and values.                                                                                                                                                                                    |
| Point of Initiation Method   | Identifies whether the data is static or dynamic. The Point of Initiation Method has a value of "11" and "12" for static and dynamic QR Code respectively. Static QR Code is shown for more than one transaction where Dynamic QR Code is shown for each transaction.                            |
| Merchant Account Information | Identifies the merchant. Merchant's payment address.                                                                                                                                                                                                                                             |
| Transaction Currency         | Indicates the currency code of the transaction.                                                                                                                                                                                                                                                  |
| Transaction Amount           | The transaction amount, if known. For instance, "99.34". If present, this value is displayed to the consumer by the mobile application when processing the transaction. If this data object is not present, the consumer is prompted to input the transaction amount to be paid to the merchant. |
| Country Code                 | Indicates the country of the merchant acceptance device.                                                                                                                                                                                                                                         |
| Merchant Name                | The “doing business as” name for the merchant, recognizable to the consumer. This name may be displayed to the consumer by the mobile application when processing the transaction.                                                                                                               |
| Merchant City                | City of operations for the merchant. This name may be displayed to the consumer by the mobile application when processing the transaction.                                                                                                                                                       |
| Bill Number                  | The invoice or bill number. This number could be provided by the merchant or could be an indication of the mobile application to prompt the consumer to input a Bill Number.                                                                                                                     |
| CRC                          | Checksum calculated over all the data objects included in the QR Code.                                                                                                                                                                                                                           |

### Data Organization

The Payload Format Indicator (ID "00") must be the first data object in the QR Code while the CRC (ID "63") must be the last data object in the QR Code. All other objects may be placed in any position.

| Data Object                    | ID    | Format               | Length        | Presence    |
| ------------------------------ | ----- | -------------------- | ------------- | ----------- |
| Payload Format Indicator       | 00    | Numeric              | 02            | Mandatory   |
| Point of Initiation Method     | 01    | Numeric              | 02            | Optional    |
| Merchant Account Information   | 02-51 | Alphanumeric Special | var. up to 99 | Mandatory   |
| Transaction Currency           | 53    | Numeric              | 03            | Mandatory   |
| Transaction Amount             | 54    | Alphanumeric Special | var. up to 13 | Conditional |
| Country Code                   | 58    | Alphanumeric Special | 02            | Mandatory   |
| Merchant Name                  | 59    | Alphanumeric Special | var. up to 25 | Mandatory   |
| Merchant City                  | 60    | Alphanumeric Special | var. up to 15 | Mandatory   |
| Additional Date Field Template | 62    | String               | var. up to 99 | Optional    |
| CRC                            | 63    | Alphanumeric Special | 04            | Mandatory   |

#### Merchant Account Information

If the Merchant Account Information is explicitly identified in the template, it needs to cintain a primitive Globally Unique Identifier data object with a data object ID "00".

The value of this data object shall contain one of the following:
- An Application Identifier (AID) consisting of a RID registered with ISO and, optionally, a PIX, as defined by [ISO 7816-4]. For example, "D840000000".
- A [UUID] without the hyphen (-) separators. For example, “581b314e257f41bfbbdc6384daa31d16”.
- A reverse domain name. For example, “com.merchant.name”.

The ID for the Merchant Account Information or any other ID other than the ID for the Globally Unique Identifier can be arbitrarily chosen.

| Name                       | ID    | Format               | Length        | Presence  |
| -------------------------- | ----- | -------------------- | ------------- | --------- |
| Globally Unique Identifier | 00    | Alphanumeric Special | var. up to 32 | Mandatory |
| Payment network specific   | 01-99 | String               |               | Optional  |


#### Additional Data Field Template

| Name        | ID  | Format               | Length        | Presence |
| ----------- | --- | -------------------- | ------------- | -------- |
| Bill Number | 01  | Alphanumeric Special | var. up to 25 | Optional |

### Representation Example

Table below shows different values needed to construct a QR code. In this example, we are constructing a dynamic QR code that Sabay Merchant is requesting a payment in Khmer Riel of 50,000 based on the invoice number 1234. 

| Date Object                  | Example             | Meaning                                  |
| ---------------------------- | ------------------- | ---------------------------------------- |
| Payload Format Indicator     | `000201`            | Version 01                               |
| Point of Initiation Method   | `010212`            | Dynamic QR Code                          |
| Merchant Account Information | `2921`              |                                          |
| Globally Unique Identifier   | `0013com.sabay.koc` | Merchant Reversed Domain:  com.sabay.koc |
| Payment Network Specific     | `0508FSADQWER`      | Payment Information: FSADQWER            |
| Transaction Currency         | `5303116`           | Khmer Riel                               |
| Transaction Amount           | `540550000`         | 500000                                   |
| Country Code                 | `5802KH`            | CAMBODIA                                 |
| Merchant Name                | `5905SABAY`         | SABAY                                    |
| Merchant City                | `6010PHNOM PENH`    | PHNOM PENH                               |
| Bill Number                  | `623301041234`      | Invoice number 1234                      |
| CRC                          | `6304749A`          | Checksum                                 |

Full representation: `00020101021229210013com.sabay.koc0508FSADQWER53031165405500005802KH5905SABAY6010PHNOM PENH6233010412346304749A`